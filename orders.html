<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Orders</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body onload="checkAdmin(); loadOrders();">

<header>
  <div class="logo">Admin Orders</div>
  <nav>
    <a href="admin-dashboard.html">Dashboard</a>
    <button class="btn btn-outline" onclick="logoutAdmin()">Logout</button>
  </nav>
</header>

<main class="container">
  <h2>Orders</h2>
  <div id="orderList"></div>
</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabase.js"></script>
<script src="js/auth.js"></script>
<script>
  async function loadOrders() {
    const box = document.getElementById("orderList");
    box.innerHTML = "Loading orders...";

    const { data, error } = await db
      .from("orders")
      .select("*")
      .order("id", { ascending: false });

    if (error) {
      box.innerHTML = "Failed to load orders.";
      console.error(error);
      return;
    }

    if (!data || data.length === 0) {
      box.innerHTML = "No orders yet.";
      return;
    }

    box.innerHTML = "";
    data.forEach(o => {
      let items = [];
      try {
        items = JSON.parse(o.items_json || "[]");
      } catch {}

      box.innerHTML += `
        <div class="order-card">
          <h3>Order #${o.id}</h3>
          <p><strong>Name:</strong> ${o.customer_name}</p>
          <p><strong>Phone:</strong> ${o.phone || "-"}</p>
          <p><strong>Total:</strong> ₹${o.total}</p>
          <p><strong>Status:</strong> ${o.status}</p>
          <details style="margin-top:6px;">
            <summary>Items</summary>
            <ul>
              ${items.map(i => `<li>${i.name} x ${i.qty} (₹${i.price})</li>`).join("")}
            </ul>
          </details>
        </div>
      `;
    });
  }
</script>
</body>
</html>